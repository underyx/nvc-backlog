<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NVC Processing Timeframes</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bulma@0.9.2/css/bulma.min.css"
      integrity="sha256-O8SsQwDg1R10WnKJNyYgd9J3rlom+YSVcGbEF5RmfFk="
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/echarts@5.0.2/dist/echarts.min.js"
      integrity="sha256-NZlQFkif+Cpc0rqEGGpSmaU55Vw4aMWK5KC3BRACd/Q="
      crossorigin="anonymous"
    ></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-0XTNDQT90V"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-0XTNDQT90V");
    </script>
  </head>
  <body>
    <section class="section has-background-light has-text-dark">
      <main class="container is-size-6 is-max-desktop">
        <h1 class="title is-size-1">NVC Processing Timeframes</h1>
        <p class="my-4">
          All data comes from the
          <a
            href="https://travel.state.gov/content/travel/en/us-visas/immigrate/nvc-timeframes.html"
            >NVC Timeframes</a
          >
          page. There are many reports of cases that took shorter or longer than
          the numbers displayed there, but this is the best available official
          data. <span id="new-data-expected-on"></span>
        </p>
        <h2 class="subtitle is-size-3">Document review</h2>
        <p>
          Time until documents submitted on
          <a href="https://ceac.state.gov/IV/Login.aspx">CEAC</a> are reviewed
          by NVC.
        </p>
        <p class="has-text-grey">
          As of 2021 Q1,
          <a
            href="https://www.state.gov/briefing-with-consular-affairs-acting-deputy-assistant-secretary-for-visa-services-julie-m-stufft-on-the-current-status-of-immigrant-visa-processing-at-embassies-and-consulates/"
            >immigrant visas are prioritized</a
          >. It's unclear how to interpret the reported processing times along
          with this, but if you have an immigrant visa application (such as the
          CR-1/IR-1) you can probably expect shorter wait times than shown here.
        </p>
        <div id="review" style="width: 100%; height: 400px"></div>
        <h2 class="subtitle is-size-3">Case creation</h2>
        <p>
          Time after USCIS sends a case to the NVC until the NVC creates a case
          for it in
          <a href="https://ceac.state.gov/IV/Login.aspx">CEAC</a>.
        </p>
        <p class="has-text-grey">
          Some time elapses after USCIS approval before they send the case to
          the NVC.
        </p>
        <div id="creation" style="width: 100%; height: 400px"></div>
        <h2 class="subtitle is-size-3">Inquiries</h2>
        <p>
          Time until questions and requests sent via
          <a
            href="https://travel.state.gov/content/travel/en/us-visas/visa-information-resources/ask-nvc.html"
            >NVC's public inquiry form</a
          >
          are answered.
        </p>
        <div id="inquiry" style="width: 100%; height: 400px"></div>
      </main>
    </section>
    <footer class="footer has-background-light has-text-dark has-text-centered">
      Data updates every four hours and is stored in a
      <a href="https://github.com/underyx/nvc-backlog/blob/main/data.json"
        >JSON file on GitHub</a
      >.<br />Project made by <a href="https://underyx.me">underyx</a>. Good
      luck to you all!
    </footer>
    <script type="module">
      import {
        add,
        getISODay,
      } from "https://cdn.jsdelivr.net/npm/date-fns@2.20.1/+esm";

      const NVC_TZ_OFFSET_MINS = 5 * 60;

      fetch("data.json")
        .then((response) => response.json())
        .then((payload) => {
          for (const [chartId, data] of Object.entries(payload)) {
            const chart = echarts.init(document.getElementById(chartId));

            chart.setOption({
              animation: false,
              tooltip: {
                trigger: "axis",
                formatter: (params, ticket) => {
                  const [series] = params;
                  const [dateString, backlogDays] = series.data;
                  const date = new Date(dateString);
                  const processingDate = add(date, {
                    days: -backlogDays,
                  });

                  const tooltip = document.createElement("div");
                  tooltip.appendChild(
                    document.createTextNode(
                      `${backlogDays} days of backlog on ${date.toDateString()}`
                    )
                  );
                  tooltip.appendChild(document.createElement("br"));
                  tooltip.appendChild(
                    document.createTextNode(
                      `(processed up to ${processingDate.toDateString()})`
                    )
                  );

                  return tooltip;
                },
              },
              legend: {
                data: [chartId],
              },
              xAxis: {
                type: "time",
              },
              yAxis: { type: "value", boundaryGap: [0, "100%"], name: "days" },
              series: [
                {
                  name: "Backlog",
                  type: "line",
                  smooth: true,
                  data: Object.entries(data),
                },
              ],
            });
            window.addEventListener("resize", chart.resize);
          }

          const dates = Object.keys(payload.creation);
          const latestDate = new Date(dates[dates.length - 1]);

          const today = add(new Date(), {
            minutes: new Date().getTimezoneOffset() - NVC_TZ_OFFSET_MINS,
          });
          const daysTillNewData =
            getISODay(today) === 1 &&
            latestDate.toDateString() !== today.toDateString()
              ? 0
              : 8 - getISODay(today);

          document.getElementById(
            "new-data-expected-on"
          ).innerText = `New data expected ${
            daysTillNewData === 0
              ? "later today"
              : daysTillNewData === 1
              ? "tomorrow"
              : `in ${daysTillNewData} days`
          } (EST).`;
        });
    </script>
  </body>
</html>
